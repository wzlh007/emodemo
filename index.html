<!DOCTYPE html>
<html lang="en">
  <head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>VGI Data Visualization</title>
	<script type="text/javascript" src="3rdParty/jquery-ui-1.10.3/jquery-1.9.1.js"></script>
	<script type="text/javascript" src="3rdParty/jquery-ui-1.10.3/ui/jquery-ui.js"></script>
    <script type="text/javascript" src="3rdParty/cesium/Build/Cesium/Cesium.js"></script>
    <script type="text/javascript" src="3rdParty/cesium/Build/Cesium/cartoDB.js"></script>
    <script type="text/javascript" src="3rdParty/d3/d3.v3.js"></script>
 	<script type="text/javascript">
		var sharedObject = {
			dispatch : d3.dispatch("nationMouseover"),
			yearData : [],
			flyTo : null
		};
    </script> 
    <style>
      @import url(3rdParty/jquery-ui-1.10.3/themes/vader/jquery-ui.css);
      @import url(d3chart.css);
      @import url(3rdParty/cesium/Build/Cesium/Widgets/widgets.css);
      body {
        padding: 0;
        margin: 0;
        overflow: hidden;
      }
    </style>
  </head>
<body>
	<div id="cesiumContainer"></div>
	<div id="radio" style="position:absolute; top:0px; right:50%; height: 30px">
		<input type="radio" id="weiboCount" name="weiboCountbiFollow" checked="checked"><label for="weiboCount">微博数</label>
		<input type="radio" id="biFollow" name="weiboCountbiFollow"><label for="biFollow">平均互粉数</label>
	</div>
	<div id="radio2" style="position:absolute; bottom:8%; right:20%;  border-radius: 7px;">
		<input type="radio" id="grid" name="gridpoi" checked="checked" "><label  for="grid">网格</label>
		<input type="radio" id="restaurant" name="gridpoi" "><label for="restaurant">餐饮POI数量</label>
		<input type="radio" id="scene" name="gridpoi" "><label  for="scene">景点POI数量</label>
	</div>
	<div id="chart"></div>
	<div id="info" title="weibo"></div>
	<script type="text/javascript">
		var basemapProvider = new Cesium.CartoDBImageryProvider({
			url: 'http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png',
			credit: 'Basemap courtesy of CartoDB'
		});
		
		var viewer = new Cesium.Viewer('cesiumContainer', 
		{
			fullscreenElement : document.body,
			infoBox : false,
			imageryProvider: basemapProvider,
			baseLayerPicker: false,
			fullscreenButton: false,
			homeButton: false,
			//timeline: false,
			navigationHelpButton: false,
			//animation: false,
			//scene3DOnly: true,
			geocoder: false
		});
		//var data = viewer.dataSources.add(Cesium.CzmlDataSource.load('result1.czml'));
		var grid = new Cesium.GeoJsonDataSource();
		grid.load('gridwithvalue.geojson',{
			strokeWidth:1,
			stroke:Cesium.Color.GREY,
			fill: Cesium.Color.fromRgba(0,0,0,0)
		});
		showGrid('grid');
		var data = viewer.dataSources.add(Cesium.CzmlDataSource.load('result1.czml'));
		viewer.zoomTo(data);
		function showGrid(label){
			viewer.dataSources.removeAll();
			console.log('start');
			var entities = grid.entities.values;
			console.log(grid);
			for (var i = 0; i < entities.length; i++) {
				console.log('haha');
				//For each entity, create a random color based on the state name.
				//Some states have multiple entities, so we store the color in a
				//hash so that we use the same color for the entire state.
				var entity = entities[i];
				//var name = entity.name;
				var color;
				if(label === 'grid'){
					color = Cesium.Color.fromRgba(0,0,0,0);
					entity.polygon.outlineWidth = 1;
					entity.polygon.outlineColor = Cesium.Color.GREY;				
					entity.polygon.outline = true;
					entity.polygon.material = color;
					
				}
				else if(label === 'restaurant'){
					color = fillGrid(entity.properties.restaurant);
					entity.polygon.outline = false;
					entity.polygon.material = color;
				}
				else if(label === 'scene'){
					color = fillGrid2(entity.properties.scene);
					entity.polygon.outline = false;
					entity.polygon.material = color;
				}
			}
			viewer.dataSources.add(grid);
			
			//viewer.dataSources.add(demo);
		}
		
		$("input[name='gridpoi']").change(function(d){
			showGrid(d.target.id);
		});
		
		var value2color = [[12,50],[34,47],[62,44],[97,41],[131,38],[178,35],[275,32],[448,29],[662,26],[1008,23]];
		var value2color2 = [1,3,6,9,12,15,20,28,38,83];
		function fillGrid(num){
			var i = 0;
			for(i = 0;i < value2color.length;i++){
				if(num <= value2color[i][0]){
					var color = Cesium.Color.fromHsl(value2color[i][1]/360, 1, 0.8-i*0.02, 1);
					return color;
				}
			}
		}
		function fillGrid2(num){
			var i = 0;
			 for(i = 0;i < value2color2.length;i++){
				if(num <= value2color2[i]){
					var color = Cesium.Color.fromHsl(205/360, 0.61, 0.8-i*0.04, 1);
					return color;
				}
			} 
		}
	</script>
	<!-- <script type="text/javascript" src="d3example.js" charset="utf-8"></script> -->
	<!-- <script type="text/javascript" src="globe.js" charset="utf-8"></script> -->
</body>
</html>